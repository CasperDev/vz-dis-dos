<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Memory resident workspaces &mdash; Laser310/VZ300 DOS 1.2 1.0 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="8. Communication between the DOS and the Floppy Disk Controller" href="../Chapter8/index.html" />
    <link rel="prev" title="Structure and organization of the diskette" href="diskette.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> Laser310/VZ300 DOS 1.2
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Table of Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../Chapter0/index.html">0. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Chapter1/index.html">1. The LASER 110, 210 and 310 Disk System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Chapter2/index.html">2. DOS Operations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Chapter3/index.html">3. The individual DOS commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Chapter4/index.html">4. Error Messages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Chapter5/index.html">5. Programming tips</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Chapter6/index.html">6. Application example</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">7. Technical Information</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="diskette.html">Structure and organization of the diskette</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Memory resident workspaces</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#dos-vectors">DOS vectors</a></li>
<li class="toctree-l3"><a class="reference internal" href="#file-control-blocks-fcb">File Control Blocks (FCB)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#input-output-buffer">Input/Output Buffer</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Chapter8/index.html">8. Communication between the DOS and the Floppy Disk Controller</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Chapter9/index.html">9. The most important DOS routines and their application іп machine programs.</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Laser310/VZ300 DOS 1.2</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">7. Technical Information</a></li>
      <li class="breadcrumb-item active">Memory resident workspaces</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/Chapter7/memory.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="memory-resident-workspaces">
<h1>Memory resident workspaces<a class="headerlink" href="#memory-resident-workspaces" title="Permalink to this heading"></a></h1>
<p class="linemarker linemarker-7">To process the diskettes, DOS creates various data structures in the last 310 bytes
of the available RAM memory, which contain processing vectors, file management
blocks and input/output buffers (Figure 1.7).</p>
<figure class="align-center" id="id1">
<a class="reference internal image-reference" href="../_images/Figure7_1.jpg"><img alt="../_images/Figure7_1.jpg" src="../_images/Figure7_1.jpg" style="width: 640px;" /></a>
<figcaption>
<p><span class="caption-text">Figure 7.1 The memory areas of DOS</span><a class="headerlink" href="#id1" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<section id="dos-vectors">
<h2>DOS vectors<a class="headerlink" href="#dos-vectors" title="Permalink to this heading"></a></h2>
<p class="linemarker linemarker-21">The first 67 bytes of this DOS work area contain the DOS vectors.</p>
<p class="linemarker linemarker-23">The address of the start of the DOS vectors is stored by DOS during system
initialization to the Z80 register ‘IY’. DOS expects that this register will not be
changed by user programs, otherwise a system crash will inevitably occur and data
on the diskette may also be destroyed (bitter experience of the author).</p>
<p class="linemarker linemarker-28">The DOS vector area is structured as follows:</p>
<p class="linemarker linemarker-30"><strong>DOSVTR = IY</strong></p>
<table class="docutils align-default">
<colgroup>
<col style="width: 16%" />
<col style="width: 7%" />
<col style="width: 10%" />
<col style="width: 67%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p class="linemarker linemarker-37">Name</p></td>
<td><p class="linemarker linemarker-37">Bytes</p></td>
<td><p class="linemarker linemarker-37">Offset</p></td>
<td><p class="linemarker linemarker-37">Description</p></td>
</tr>
<tr class="row-even"><td><p class="linemarker linemarker-39">FILNO</p></td>
<td><p class="linemarker linemarker-39">1</p></td>
<td><p class="linemarker linemarker-39">IY+0</p></td>
<td><p class="linemarker linemarker-39">File number. <br />
When processing a data file, this is the <br />
number of the file management block
(FCB) used. <br />
0 = FCB1 , 1 = FCB2 <br /></p></td>
</tr>
<tr class="row-odd"><td><p class="linemarker linemarker-45">FNAM</p></td>
<td><p class="linemarker linemarker-45">8</p></td>
<td><p class="linemarker linemarker-45">IY+1</p></td>
<td><p class="linemarker linemarker-45">Filename <br />
Name of the file to edit. must be <br />
entered by the user program before <br />
each file/program access. <br /></p></td>
</tr>
<tr class="row-even"><td><p class="linemarker linemarker-50">TYPE</p></td>
<td><p class="linemarker linemarker-50">2</p></td>
<td><p class="linemarker linemarker-50">IY+9</p></td>
<td><p class="linemarker linemarker-50">File Type <br />
Byte 1 = target type. <br />
Byte 2 = actual type. <br />
From the user program, the type of file <br />
to be processed is in the first byte. <br /></p></td>
</tr>
<tr class="row-odd"><td><p class="linemarker linemarker-56">DK</p></td>
<td><p class="linemarker linemarker-56">1</p></td>
<td><p class="linemarker linemarker-56">IY+11</p></td>
<td><p class="linemarker linemarker-56">Selected Drive. <br />
X’10’ = Drive 1 <br />
X’80’ = Drive 2 <br />
X’10’ is set during initialization. <br /></p></td>
</tr>
<tr class="row-even"><td><p class="linemarker linemarker-61">RQST</p></td>
<td><p class="linemarker linemarker-61">1</p></td>
<td><p class="linemarker linemarker-61">IY+12</p></td>
<td><p class="linemarker linemarker-61">Access type. <br />
0 = read <br />
1 = write <br />
Must be set by the user program. <br />
With BASIC, this is done with the <br />
With BASIC, this is done with the <br />
With BASIC, this is done with the <br />
OPEN command. <br /></p></td>
</tr>
<tr class="row-odd"><td><p class="linemarker linemarker-70">SOURCE</p></td>
<td><p class="linemarker linemarker-70">1</p></td>
<td><p class="linemarker linemarker-70">IY+13</p></td>
<td><p class="linemarker linemarker-70">Starting drive (source) used by <br />
DCOPY command (1 or 2) <br /></p></td>
</tr>
<tr class="row-even"><td><p class="linemarker linemarker-73">UBFR</p></td>
<td><p class="linemarker linemarker-73">2</p></td>
<td><p class="linemarker linemarker-73">IY+14</p></td>
<td><p class="linemarker linemarker-73">Address of a user buffer area to or <br />
from which data is to be transferred. <br />
When loading and saving programs, <br />
this is the program area. <br />
When reading data files, it is the <br />
BASIC input/output buffer <br /></p></td>
</tr>
<tr class="row-odd"><td><p class="linemarker linemarker-80">DESTIN</p></td>
<td><p class="linemarker linemarker-80">1</p></td>
<td><p class="linemarker linemarker-80">IY+16</p></td>
<td><p class="linemarker linemarker-80">Target drive for the DCOPY command <br />
(1 or 2) <br /></p></td>
</tr>
<tr class="row-even"><td><p class="linemarker linemarker-83">SCTR</p></td>
<td><p class="linemarker linemarker-83">1</p></td>
<td><p class="linemarker linemarker-83">IY+17</p></td>
<td><p class="linemarker linemarker-83">Number of the Sector to be addressed <br /></p></td>
</tr>
<tr class="row-odd"><td><p class="linemarker linemarker-85">TRCK</p></td>
<td><p class="linemarker linemarker-85">1</p></td>
<td><p class="linemarker linemarker-85">IY+18</p></td>
<td><p class="linemarker linemarker-85">Number of the Track to be addressed <br /></p></td>
</tr>
<tr class="row-even"><td><p class="linemarker linemarker-87">RETRY</p></td>
<td><p class="linemarker linemarker-87">1</p></td>
<td><p class="linemarker linemarker-87">IY+19</p></td>
<td><p class="linemarker linemarker-87">Retry counter for read errors <br />
(checksum). <br />
Set to 10 upon initialization. <br /></p></td>
</tr>
<tr class="row-odd"><td><p class="linemarker linemarker-91">DTRCK</p></td>
<td><p class="linemarker linemarker-91">1</p></td>
<td><p class="linemarker linemarker-91">IY+20</p></td>
<td><p class="linemarker linemarker-91">Current track number over which the <br />
read/write head is located. <br /></p></td>
</tr>
<tr class="row-even"><td><p class="linemarker linemarker-94">NSCT</p></td>
<td><p class="linemarker linemarker-94">1</p></td>
<td><p class="linemarker linemarker-94">IY+21</p></td>
<td><p class="linemarker linemarker-94">Marker field for the next sector to be <br />
addressed. <br /></p></td>
</tr>
<tr class="row-odd"><td><p class="linemarker linemarker-97">NTRK</p></td>
<td><p class="linemarker linemarker-97">1</p></td>
<td><p class="linemarker linemarker-97">IY+22</p></td>
<td><p class="linemarker linemarker-97">Marker field for the next track to be <br />
addressed. <br /></p></td>
</tr>
<tr class="row-even"><td><p class="linemarker linemarker-100">FCB1</p></td>
<td><p class="linemarker linemarker-100">13</p></td>
<td><p class="linemarker linemarker-100">IY+23</p></td>
<td><p class="linemarker linemarker-100">File management block 1. <br />
(see Structure description)  <br /></p></td>
</tr>
<tr class="row-odd"><td><p class="linemarker linemarker-103">FCB2</p></td>
<td><p class="linemarker linemarker-103">13</p></td>
<td><p class="linemarker linemarker-103">IY+36</p></td>
<td><p class="linemarker linemarker-103">File management block 2. <br />
(see Structure description) <br /></p></td>
</tr>
<tr class="row-even"><td><p class="linemarker linemarker-106">DBFR</p></td>
<td><p class="linemarker linemarker-106">2</p></td>
<td><p class="linemarker linemarker-106">IY+49</p></td>
<td><p class="linemarker linemarker-106">Pointer to the DOS data buffer for <br />
writing and reading a sector This is <br />
located immediately after the DOS <br />
vectors in the work area. <br /></p></td>
</tr>
<tr class="row-odd"><td><p class="linemarker linemarker-111">LTHCPY</p></td>
<td><p class="linemarker linemarker-111">1</p></td>
<td><p class="linemarker linemarker-111">IY+51</p></td>
<td><p class="linemarker linemarker-111">Copy of the command byte sent to the <br />
Floppy Disk Controller. <br /></p></td>
</tr>
<tr class="row-even"><td><p class="linemarker linemarker-114">MAPADR</p></td>
<td><p class="linemarker linemarker-114">2</p></td>
<td><p class="linemarker linemarker-114">IY+52</p></td>
<td><p class="linemarker linemarker-114">Pointer to the DOS buffer in which the <br />
sector occupancy overview is <br />
temporarily stored. <br />
This is behind the data buffer in the <br />
work area. <br /></p></td>
</tr>
<tr class="row-odd"><td><p class="linemarker linemarker-120">TRKCNT</p></td>
<td><p class="linemarker linemarker-120">1</p></td>
<td><p class="linemarker linemarker-120">IY+54</p></td>
<td><p class="linemarker linemarker-120">Track counter for the DCOPY <br />
command <br /></p></td>
</tr>
<tr class="row-even"><td><p class="linemarker linemarker-123">TRKPTR</p></td>
<td><p class="linemarker linemarker-123">1</p></td>
<td><p class="linemarker linemarker-123">IY+55</p></td>
<td><p class="linemarker linemarker-123">Track pointer for the DCOPY <br />
command <br /></p></td>
</tr>
<tr class="row-odd"><td><p class="linemarker linemarker-126">PHASE</p></td>
<td><p class="linemarker linemarker-126">1</p></td>
<td><p class="linemarker linemarker-126">IY+56</p></td>
<td><p class="linemarker linemarker-126">Step pulse raster for track adjustment. <br /></p></td>
</tr>
<tr class="row-even"><td><p class="linemarker linemarker-128">DCPYF</p></td>
<td><p class="linemarker linemarker-128">1</p></td>
<td><p class="linemarker linemarker-128">IY+57</p></td>
<td><p class="linemarker linemarker-128">Flag for DCOPY <br /></p></td>
</tr>
<tr class="row-odd"><td><p class="linemarker linemarker-130">RESVE</p></td>
<td><p class="linemarker linemarker-130">10</p></td>
<td><p class="linemarker linemarker-130">IY+58</p></td>
<td><p class="linemarker linemarker-130">reserved for extensions. <br /></p></td>
</tr>
</tbody>
</table>
</section>
<section id="file-control-blocks-fcb">
<h2>File Control Blocks (FCB)<a class="headerlink" href="#file-control-blocks-fcb" title="Permalink to this heading"></a></h2>
<p class="linemarker linemarker-138">Within the DOS vectors are two 13 byte file management blocks, FCB1 and FCB2.</p>
<p class="linemarker linemarker-140">These are required when processing data files in order to keep status and control
information about the file being accessed.</p>
<p class="linemarker linemarker-143">A free file management block is determined by the OPEN command and provided
with the necessary parameters for the file to be opened.</p>
<p class="linemarker linemarker-146">The IN# and PR# commands are based on the relevant file management block, e.g.
which sector of the file is to be read and at which byte of this sector processing is to
be continued.</p>
<p class="linemarker linemarker-150">The file management blocks are released again by the CLOSE command.</p>
<p class="linemarker linemarker-152">Since there are only two of these blocks, only two files can be open at the same
time.</p>
<p class="linemarker linemarker-155">The File Control Block has the following structure:</p>
<p class="linemarker linemarker-157">FCB1 or FCB2</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 15%" />
<col style="width: 7%" />
<col style="width: 9%" />
<col style="width: 69%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p class="linemarker linemarker-160">Name</p></td>
<td><p class="linemarker linemarker-160">Bytes</p></td>
<td><p class="linemarker linemarker-160">Offset</p></td>
<td><p class="linemarker linemarker-160">Description</p></td>
</tr>
<tr class="row-even"><td><p class="linemarker linemarker-162">FLAG</p></td>
<td><p class="linemarker linemarker-162">1</p></td>
<td><p class="linemarker linemarker-162">0</p></td>
<td><p class="linemarker linemarker-162">Indicates the status of the FCB. <br />
0 - FCB not used                         <br />
1 - FCB used, file currently not active <br />
2 - FCR used, file active.           <br />
Active means that currently a current sector of <br />
this file is in the data buffer for processing <br /></p></td>
</tr>
<tr class="row-odd"><td><p class="linemarker linemarker-169">ACCESS</p></td>
<td><p class="linemarker linemarker-169">1</p></td>
<td><p class="linemarker linemarker-169">1</p></td>
<td><p class="linemarker linemarker-169">Access type for this file. <br />
0 - read <br />
1 - write <br /></p></td>
</tr>
<tr class="row-even"><td><p class="linemarker linemarker-173">FNAM</p></td>
<td><p class="linemarker linemarker-173">8</p></td>
<td><p class="linemarker linemarker-173">2</p></td>
<td><p class="linemarker linemarker-173">Filename <br /></p></td>
</tr>
<tr class="row-odd"><td><p class="linemarker linemarker-175">TRK#</p></td>
<td><p class="linemarker linemarker-175">1</p></td>
<td><p class="linemarker linemarker-175">10</p></td>
<td><p class="linemarker linemarker-175">Track Number <br /></p></td>
</tr>
<tr class="row-even"><td><p class="linemarker linemarker-177">SCTR#</p></td>
<td><p class="linemarker linemarker-177">1</p></td>
<td><p class="linemarker linemarker-177">11</p></td>
<td><p class="linemarker linemarker-177">Sector Number of currently processed Sector <br /></p></td>
</tr>
<tr class="row-odd"><td><p class="linemarker linemarker-179">PTR</p></td>
<td><p class="linemarker linemarker-179">1</p></td>
<td><p class="linemarker linemarker-179">12</p></td>
<td><p class="linemarker linemarker-179">Pointer to the next byte to be processed  <br />
in the above sector. <br /></p></td>
</tr>
</tbody>
</table>
</section>
<section id="input-output-buffer">
<h2>Input/Output Buffer<a class="headerlink" href="#input-output-buffer" title="Permalink to this heading"></a></h2>
<p class="linemarker linemarker-187">In the DOS work area there are two buffer areas, one for temporary storage of the
sectors to be read or written and a second for the sector occupancy overview.</p>
<p class="linemarker linemarker-190"><strong>Data Buffer (DBFR)</strong></p>
<p class="linemarker linemarker-192">This buffer has a size of 154 bytes and serves as a buffer for direct data exchange
with the floppy disk.</p>
<p class="linemarker linemarker-195">When writing, the sectors are transferred from the data buffer to the diskette; when
reading, the sectors are transferred from the diskette to the data buffer.</p>
<p class="linemarker linemarker-198">During initialization, the 18 bytes of the data mark are set in front of the data buffer,
so that a complete information block (data mark + data field) is available when a
sector is written.</p>
<p class="linemarker linemarker-202">During normal read/write operations, only the first 128 bytes of the data buffer are
used to hold a sector’s data field.</p>
<p class="linemarker linemarker-205">The full length of 154 bytes is only required during diskette initialization to
accommodate a complete sector, including all sync fields, address fields, and
identifiers.</p>
<p class="linemarker linemarker-209"><strong>Allocation Map Sector (MAP)</strong></p>
<p class="linemarker linemarker-211">At the end of the DOS work area there is an 80-byte buffer area in which the
Allocation Map from sector 15 of track 0 on the diskette is buffered.</p>
<p class="linemarker linemarker-214">When saving a program or writing a data file, the sectors are selected and allocated
exclusively in this buffer area after the current sector has been read in at the
beginning. Only when the saving process for the program is complete, the
Allocation Map (MAP) is written back to the diskette.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="diskette.html" class="btn btn-neutral float-left" title="Structure and organization of the diskette" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../Chapter8/index.html" class="btn btn-neutral float-right" title="8. Communication between the DOS and the Floppy Disk Controller" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 1985, Gerhard Wolf (translation 2023, Casper).</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>